<!doctype html>
<html lang="it">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AmiciCari.tv</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <div class="aurora-container"></div>

  <div class="app">
    <!-- ===== TOPBAR FISSA ===== -->
    <!-- ===== TOPBAR FISSA ===== -->
    <header class="topbar">
      <div class="topbar-inner container">
        <div class="brand" id="brandLogo">
          <img src="AMICI-Photoroom.png" alt="AmiciCari Logo" class="logo-img" />
        </div>

        <nav class="nav-center-box" aria-label="Navigazione principale">
          <ul>
            <li class="active"><a href="#" id="navHomeBtn">Home</a></li>
            <li><a href="#" id="navAllBtn">Tutti</a></li>
            <li><a href="#/film" id="nav-film">Film</a></li>
            <li><a href="#/serie" id="nav-serie">Serie</a></li>
            <li><a href="#" id="navRouletteBtn">Roulette</a></li>
          </ul>
        </nav>

        <button id="profileBtn" class="profile-btn" aria-haspopup="menu" aria-expanded="false" aria-label="Profilo">
          <img id="profileAvatar" class="profile-avatar" alt="Avatar" />
          <span id="profileName" class="profile-name">Profilo</span>
        </button>
      </div>
    </header>


    <!-- MENU PROFILO (assoluto, fuori dal flusso) -->
    <div id="profileMenu" class="profile-menu" role="menu" aria-hidden="true">
      <button id="profileSwitch" class="profile-menu-item" role="menuitem">Cambia profilo</button>
      <button id="profileLogout" class="profile-menu-item" role="menuitem">Logout</button>
    </div>

    <!-- Spaziatore snap per sticky/snap (se usato) -->
    <div class="snap-dock" aria-hidden="true"></div>

    <!-- ===== CONTENUTO PAGINA ===== -->
    <main class="page" role="main">
      <!-- HOME -->
      <section id="home" class="home">
        <div id="homeHero" class="hero is-collapsed" role="region" aria-live="polite">
          <div class="hero__media">
            <div id="heroBackground" class="hero__media-img" role="presentation"></div>
            <div class="hero__scrim"></div>
          </div>
          <div class="hero__content container">
            <span id="heroTag" class="hero__tag is-hidden"></span>
            <h1 id="heroTitle" class="hero__title">In evidenza</h1>
            <p id="heroDescription" class="hero__description is-hidden"></p>
            <div id="heroMeta" class="hero__meta is-hidden"></div>
            <div class="hero__actions">
              <button id="heroPlay" class="btn primary" type="button">Riproduci</button>
              <button id="heroMore" class="btn ghost" type="button">Dettagli</button>
            </div>
          </div>
        </div>

        <div class="home-content container">
          <div id="searchStatus" class="search-status" style="display:none"></div>
          <div id="homeCarousels" class="carousel-stack"></div>
        </div>
      </section>

      <!-- TUTTI -->
      <section id="all" class="all" style="display:none">
        <div class="container">
          <h2 class="all-title">Tutti gli anime</h2>
          <div class="all-toolbar" role="region" aria-label="Filtra catalogo anime">
            <label class="all-filter">
              <span class="all-filter__label">Cerca</span>
              <input id="allFilterSearch" class="all-filter__input" type="search" placeholder="Titolo o lingua" autocomplete="off" />
            </label>
            <label class="all-filter">
              <span class="all-filter__label">Lingua</span>
              <select id="allFilterLanguage" class="all-filter__select">
                <option value="all">Tutte</option>
              </select>
            </label>
            <label class="all-filter">
              <span class="all-filter__label">Formato</span>
              <select id="allFilterFormat" class="all-filter__select">
                <option value="all">Qualsiasi</option>
                <option value="series">Serie</option>
                <option value="movie">Film/Special</option>
              </select>
            </label>
            <button id="allFilterReset" class="all-filter__reset" type="button">Azzera</button>
          </div>
          <div id="allGrid" class="all-grid"></div>
        </div>
      </section>

      <!-- ROULETTE -->
      <section id="roulette" class="roulette" style="display:none">
        <div class="container roulette-container">
          <header class="roulette-header">
            <h1 class="roulette-title">Roulette</h1>
            <p class="roulette-subtitle">Lasciati sorprendere da un film scelto casualmente tra i migliori titoli
              disponibili.</p>
          </header>

          <div class="roulette-carousel" id="rouletteCarousel" aria-hidden="true"></div>

          <div class="roulette-controls">
            <button id="rouletteSpin" class="btn primary roulette-spin-btn" type="button">Gira</button>
          </div>

          <div class="roulette-result" id="rouletteResult" aria-live="polite"></div>
        </div>
      </section>

      <!-- WATCH -->
      <section id="watch" class="watch" style="display:none">
        <div class="watch-hero">
          <img id="watchBanner" class="watch-banner" src="" alt="Banner serie" />
          <div class="watch-hero-overlay">
            <div class="watch-hero-header">
              <h1 id="watchTitle">Titolo Anime</h1>
              <div id="watchHeroMeta" class="watch-hero-meta"></div>
            </div>
            <p id="watchSummary" class="watch-hero-summary">Seleziona una serie per leggere la sinossi e iniziare la visione.</p>
            <div id="watchHeroBadges" class="watch-hero-badges"></div>
            <div class="watch-hero-actions">
              <button id="watchResumeBtn" class="btn danger" style="display:none;">▶ Riprendi</button>
              <button id="watchHeroMore" class="btn ghost" type="button" disabled>Dettagli serie</button>
            </div>
          </div>
        </div>

        <div class="watch-container">
          <div class="watch-layout">
            <div class="watch-primary">
              <div id="seasonPicker" class="season-picker"></div>
              <div id="episodeList" class="episode-list"></div>
            </div>

            <aside class="watch-details" aria-label="Dettagli serie">
              <header class="watch-details__head">
                <h2 class="watch-details__title">Approfondisci</h2>
                <button id="watchDetailsMore" class="watch-details__expand" type="button" aria-expanded="false">Apri scheda completa</button>
              </header>

              <p id="watchSynopsis" class="watch-synopsis">Seleziona una serie per vedere sinossi, lingue e altri dettagli.</p>

              <dl class="watch-meta" aria-live="polite">
                <div class="watch-meta__row">
                  <dt>Formato</dt>
                  <dd id="watchFormat">—</dd>
                </div>
                <div class="watch-meta__row">
                  <dt>Stagioni</dt>
                  <dd id="watchSeasons">—</dd>
                </div>
                <div class="watch-meta__row">
                  <dt>Episodi totali</dt>
                  <dd id="watchEpisodes">—</dd>
                </div>
                <div class="watch-meta__row">
                  <dt>Lingue</dt>
                  <dd id="watchLanguages">—</dd>
                </div>
                <div class="watch-meta__row">
                  <dt>Sorgenti</dt>
                  <dd id="watchSources">—</dd>
                </div>
              </dl>

              <div class="watch-tags" id="watchTags" aria-live="polite"></div>
            </aside>
          </div>
        </div>
      </section>
    </main>

    <!-- PLAYER OVERLAY (fuori da <main> per coprire tutto quando attivo) -->
    <div id="playerOverlay" class="player-overlay" style="display:none">
      <div class="player-shell">
        <div class="player-bar">
          <button id="playerClose" class="btn">← Episodi</button>
          <div class="player-meta">
            <strong id="nowTitle">Titolo</strong>
            <span id="nowInfo" class="now-info"></span>
          </div>
          <div class="player-controls">
            <button class="btn" id="prevEp">◀︎ Precedente</button>
            <button class="btn primary" id="nextEp">Successiva ▶︎</button>
          </div>
        </div>

        <div class="player-video">
          <video id="video" controls autoplay playsinline x-webkit-airplay="allow" controlslist="nodownload">
            <source id="episode" type="video/mp4" src="" />
          </video>
        </div>
      </div>
    </div>
  </div>

  <!-- AUTH MODAL -->
  <div id="authModal" class="auth-modal-backdrop" style="display:none;">
    <div class="auth-modal-card">
      <div class="auth-tabs">
        <button class="auth-tab-btn active" data-tab="login" type="button">Login</button>
        <button class="auth-tab-btn" data-tab="signup" type="button">Signup</button>
      </div>
      <div class="auth-panel" data-panel="login" style="display:block;">
        <label for="login_username">Username</label>
        <input id="login_username" type="text" autocomplete="username" />
        <label for="login_pin">PIN</label>
        <input id="login_pin" type="password" inputmode="numeric" autocomplete="current-password" />
        <button id="login_btn" class="auth-primary-btn" type="button">Accedi</button>
        <div id="login_error" class="auth-error"></div>
        <button id="guest_btn" class="auth-secondary-btn" type="button" style="margin-top: 10px; width: 100%;">Entra
          come ospite</button>
      </div>
      <div class="auth-panel" data-panel="signup" style="display:none;">
        <label for="signup_username">Username</label>
        <input id="signup_username" type="text" autocomplete="username" />
        <label for="signup_pin">PIN</label>
        <input id="signup_pin" type="password" inputmode="numeric" autocomplete="new-password" />
        <label for="signup_avatar">Avatar URL (opzionale)</label>
        <input id="signup_avatar" type="url" />
        <button id="signup_btn" class="auth-primary-btn" type="button">Crea account</button>
        <div id="signup_error" class="auth-error"></div>
      </div>
    </div>
  </div>

  <!-- SEARCH FAB -->
  <button id="searchFab" class="search-ico" type="button" aria-label="Apri ricerca">
    <svg viewBox="0 0 250 250" width="100%" height="100%">
      <circle cx="104" cy="104" r="72" stroke="currentColor" stroke-width="24" fill="none" />
      <line x1="160" y1="160" x2="228" y2="228" stroke="currentColor" stroke-width="24" stroke-linecap="round" />
    </svg>
  </button>

  <!-- SEARCH PANEL -->
  <div id="searchPanel" class="search-panel" role="dialog" aria-modal="true" aria-hidden="true">
    <input id="searchInput" class="search-inp" type="search" autocomplete="off"
      placeholder="Cerca anime… (titolo o lingua)" />
    <button id="searchClear" class="search-clear" type="button">✕</button>
    <div class="search-filters" id="searchFilters" role="group" aria-label="Filtri di ricerca">
      <fieldset class="search-filter-group">
        <legend class="search-filter-label">Lingua</legend>
        <div id="searchFilterLanguages" class="search-filter-options"></div>
      </fieldset>
      <fieldset class="search-filter-group">
        <legend class="search-filter-label">Formato</legend>
        <div class="search-filter-options">
          <label class="search-filter-chip">
            <input type="radio" name="searchFormat" value="all" checked />
            <span>Qualsiasi</span>
          </label>
          <label class="search-filter-chip">
            <input type="radio" name="searchFormat" value="series" />
            <span>Serie</span>
          </label>
          <label class="search-filter-chip">
            <input type="radio" name="searchFormat" value="movie" />
            <span>Film/Special</span>
          </label>
        </div>
      </fieldset>
      <button id="searchFilterReset" class="search-filter-reset" type="button">Azzera filtri</button>
    </div>
  </div>

  <!-- PROFILO: selettore modale -->
  <div id="profileSwitcher" class="profile-switcher" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="profile-switcher__backdrop" data-close="profileSwitcher"></div>
    <div class="profile-switcher__dialog" role="document">
      <header class="profile-switcher__header">
        <h2 class="profile-switcher__title">Scegli un profilo</h2>
        <button id="profileSwitchClose" class="profile-switcher__close" type="button" aria-label="Chiudi selezione profili">✕</button>
      </header>
      <div id="profileSwitchList" class="profile-switcher__list" role="listbox" aria-live="polite"></div>
      <footer class="profile-switcher__footer">
        <button id="profileSwitchCancel" class="btn ghost" type="button">Annulla</button>
      </footer>
    </div>
  </div>

  <!-- Scheda contenuto dettagliata -->
  <div id="contentDrawer" class="content-drawer" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="content-drawer__backdrop" data-close="contentDrawer"></div>
    <div class="content-drawer__panel" role="document">
      <button class="content-drawer__close" id="contentDrawerClose" type="button" aria-label="Chiudi dettagli">✕</button>
      <div class="content-drawer__body" id="contentDrawerBody"></div>
    </div>
  </div>

  <!-- ================== SCRIPT ORDER ================== -->
  <script src="js/config.js"></script>
  <script>
    window.CONFIG = window.CONFIG || {};
    const isIPad = /iPad|Macintosh/.test(navigator.userAgent) && 'ontouchend' in document;
    const forceTablet = window.CONFIG.IS_TABLET_LAYOUT === true;
    if (isIPad || forceTablet) document.documentElement.classList.add('tablet');
  </script>

  <script src="js/auth.js"></script>
  <script src="js/api.js"></script>

  <script src="js/urlParser.js"></script>
  <script src="js/catalog.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ogl@0.0.63/dist/ogl.umd.js"></script>


  <script src="js/progress.js"></script>
  <script src="js/seriesHelper.js"></script>

  <script src="js/player.js"></script>
  <script src="js/aurora.js"></script>
  <script src="js/carousel.js"></script>
  <script src="js/providerCarousels.js"></script>
  <script src="js/roulettePage.js"></script>
  <script src="js/contentDetails.js"></script>
  <script src="js/homePage.js"></script>
  <script src="js/allPage.js"></script>
  <script src="js/watchPage.js"></script>

  <script src="js/search.js"></script>
  <script src="js/dockMetrics.js"></script>
  <script src="js/iptvProgress.js"></script>
  <script src="js/iptv.js"></script>
  <script src="js/routes-iptv.js"></script>
  <script src="js/ui-authmodal.js"></script>

  <script src="js/ui-manager.js"></script>
  <script src="js/userProfile.js"></script>
  <script src="js/main.js"></script>
</body>

</html>